{% extends 'BizViz/base.html' %} {% load static %} {% block css %}
<style type="text/css">
  .not-filtered {
    display: none;
  }
  ul > .selected {
    background-color: rgb(249, 249, 249);
  }
  .dropdown-item:active {
    background-color: rgb(249, 249, 249) !important;
  }
  .btn:focus,
  .btn:active,
  .form-control:focus,
  .form-control:active {
    outline: none !important;
    box-shadow: none !important;
  }
</style>
{% endblock %} {% block active %}
<li class="nav-item">
  <a class="nav-link" href="/">검색<span class="sr-only">Home</span></a>
</li>
<li class="nav-item active">
  <a class="nav-link" href="/statistics/">통계 • 분석</a>
</li>
{% endblock %} {% block content %}
<div class="content">
  <div class="main-statistics-compare">
    <div class="statistics-compare-title m-5 text-center">
      <h2>
        비교할 부서 / 지자체를 선택해주세요.
      </h2>
    </div>
    <div class="statistics-compare-area d-flex justify-content-around mb-5">
      <div class="statistics-container ml-5">
        <div class="select-depart m-2">
          <span class="compare-selected-depart">
            중소벤처기업부 <i class="fas fa-caret-down"></i>
          </span>
          <div class="dropdown">
            <button
              class="btn btn-primary dropdown-toggle"
              type="button"
              data-toggle="dropdown"
            >
              Dropdown Example <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
              <input
                class="form-control basic-search"
                id="myInput"
                type="text"
                placeholder="Search.."
                autocomplete="off"
                onkeydown="departKeydown(this)"
                oninput="departInput(this)"
              />
              <li class="filtered selected">
                <a class="dropdown-item">문화체육관광부</a>
              </li>
              <li class="filtered">
                <a class="dropdown-item">산업통상자원부</a>
              </li>
              <li class="filtered">
                <a class="dropdown-item">식품의약품안전처</a>
              </li>
              <li class="filtered">
                <a class="dropdown-item">중소벤처기업부</a>
              </li>
              <li class="filtered">
                <a class="dropdown-item">통계부</a>
              </li>
              <li class="filtered">
                <a class="dropdown-item">환경부</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="basic-department border border-secondary">
          {{ basic }}
        </div>
      </div>
      <div class="compare-exchange align-self-center">
        <span class="btn">
          <i class="fas fa-exchange-alt fa-3x"></i>
        </span>
      </div>
      <div class="statistics-container mr-5">
        <div class="select-depart m-2">
          <span class="compare-selected-depart">
            산업통상자원부 <i class="fas fa-caret-down"></i>
          </span>
        </div>
        <div class="compare-department border border-secondary">
          {{ compare }}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  // NodeList에 filter 기능 추가
  NodeList.prototype.filter = Array.prototype.filter;
  let selectionStart = 0;

  function initialConsonant(word, consonant) {
    // 초성 검색을 위한 함수
    let conso = "";
    for (let i = 0, len = word.length; i < len; i++) {
      conso += Hangul.disassemble(word[i])[0];
    }
    return Hangul.search(conso, consonant);
  }

  function departKeydown(input) {
    const filter = input.value.toUpperCase();
    const dropdownMenu = input.parentElement;
    const dropdownList = dropdownMenu.querySelectorAll("li");
    const filteredList = dropdownList.filter((li) =>
      li.classList.contains("filtered")
    );
    const selectedVal = filteredList.findIndex((li) =>
      li.classList.contains("selected")
    );

    if (event.keyCode === 13) {
      // Enter key function
      console.log("Press Enter key");
      console.log(filteredList);
    } else if (event.keyCode === 38) {
      // Arrow up function
      event.preventDefault();
      if (selectedVal > 0) {
        filteredList[selectedVal].classList.remove("selected");
        filteredList[selectedVal - 1].classList.add("selected");
        console.log(filteredList[selectedVal - 1].innerText);
      }
    } else if (event.keyCode === 40) {
      // Arrow down function
      event.preventDefault();
      if (selectedVal < filteredList.length - 1) {
        filteredList[selectedVal].classList.remove("selected");
        filteredList[selectedVal + 1].classList.add("selected");
        console.log(filteredList[selectedVal + 1].innerText);
      }
    }
  }

  function departInput(input) {
    const filter = input.value.toUpperCase();
    const dropdownMenu = input.parentElement;
    const dropdownList = dropdownMenu.querySelectorAll("li");
    let selBool = true;

    if (
      event.keyCode !== 13 &&
      event.keyCode !== 37 &&
      event.keyCode !== 38 &&
      event.keyCode !== 39 &&
      event.keyCode !== 40
    ) {
      console.log(event.keyCode);
      for (let i = 0, length = dropdownList.length; i < length; i++) {
        const li = dropdownList[i];
        const a = li.querySelector("a");
        const txtValue = (a.textContent || a.innerText).toUpperCase();
        if (
          Hangul.search(txtValue, filter) !== -1 ||
          initialConsonant(txtValue, filter) !== -1
        ) {
          li.classList.add("filtered");
          li.classList.remove("not-filtered");
          li.classList.remove("selected");
          if (selBool) {
            li.classList.add("selected");
            selBool = false;
          }
        } else {
          li.classList.remove("filtered");
          li.classList.remove("selected");
          li.classList.add("not-filtered");
        }
      }
    }
  }
  // 13 - enter 키, 38 - 위 방향키, 40 - 아래 방향키
  // addEventListener를 통해서 onmouseover, onmouseout, onkeyup envent들을 추가하면 될 듯
</script>
{% endblock %}
